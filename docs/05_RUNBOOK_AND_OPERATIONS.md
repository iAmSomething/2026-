# 운영 런북 및 체크리스트

- 문서 버전: v0.2
- 최종 수정일: 2026-02-18
- 수정자: Codex

## 1. 운영 목표
- 2시간 주기의 안정적인 데이터 수집/정규화/검증/게시
- 자동 처리와 수동 검수 경계를 명확히 유지

## 2. 배치 운영 절차 (2시간 주기)
1. 수집 시작: 기사 후보 수집
2. 판별: 여론조사 기사 여부 분류
3. 추출: 수치/문항/후보/지역 추출
4. 정규화: 값/코드/식별자 통일
5. 검증: 공식/신뢰 데이터 대조
6. 게시: 통과 데이터만 공개 API 반영
7. 기록: `ingestion_runs` 결과 저장

## 3. 수동/자동 경계
### 자동 처리
1. 중복 제거
2. 규칙 추출
3. 정규화
4. 명확 일치 검증 결과 게시

### 수동 검수 필요
1. 후보명/지역명 충돌
2. 동일 조사 수치 불일치
3. 원문 근거 부족 또는 문맥 모호
4. 코드 매핑 실패

## 4. 검수 워크플로우
1. 검수 큐 조회 (`status=pending`)
2. 이슈 타입 확인 (`mapping_error`, `value_conflict`, `source_conflict`)
3. 승인 또는 반려
4. 반려 시 사유 템플릿 기록
5. 승인 데이터 재게시

## 5. 내부 운영 API
1. 수동 배치 실행: `POST /api/v1/jobs/run-ingest`
2. 검수 승인: `POST /api/v1/review/{item_id}/approve`
3. 검수 반려: `POST /api/v1/review/{item_id}/reject`

## 6. 장애 대응
1. 수집 실패:
- 네트워크 상태 확인
- 재시도 큐 실행
2. 파싱 실패:
- 원문 저장 여부 확인
- 파서 규칙 업데이트
3. DB 실패:
- 연결 상태 점검
- 트랜잭션 롤백 확인
4. API 응답 이상:
- 헬스체크
- 직전 배포 버전 롤백

## 7. 재처리 운영
1. 기간 지정 재처리
2. 소스 지정 재처리
3. 검수 반영 후 부분 재집계
4. 재처리 이력 `ingestion_runs`에 분리 기록

## 8. 모니터링 체크리스트
1. 배치 성공률
2. 기사 수집량 대비 추출 성공률
3. 검수 큐 적체량
4. 공개 API 오류율/지연시간
5. 키 만료/쿼터 초과 알림

## 8.1 운영 SLO/KPI
1. 추출 품질 KPI: 핵심 수치 추출 Precision >= 0.90 (샘플 100건 수동 검수)
2. 배치 안정성 KPI: 7일 연속 정기 배치 성공
3. 검수 처리 KPI: `pending` 24시간 초과 건수 최소화

## 9. 일일 운영 체크
1. 새벽 배치 실패 여부
2. 검수 큐 24시간 초과 항목 여부
3. 빅매치 계산 결과 이상치 여부
4. 지도 데이터 누락 지역 여부

## 10. 준법 체크
1. robots 정책 위반 요청 로그 여부
2. 기사 원문 저장 모드가 최소 스팬 기본값으로 유지되는지 확인
3. 외부 공개 시 출처 URL/근거 표기가 누락되지 않았는지 확인
