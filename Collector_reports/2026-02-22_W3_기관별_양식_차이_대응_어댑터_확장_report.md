# [COLLECTOR][W3] 기관별 양식 차이 대응 어댑터 확장 보고서 (#183)

- 보고일: 2026-02-22
- 작성자: Codex (Collector 담당)
- 대상 이슈: `#183` `[COLLECTOR][W3] NESDC PDF 템플릿 어댑터 확장(기관 5종)`

## 1. 완료 요약
1. NESDC PDF 어댑터를 Top2 파일럿(v1)에서 기관 5종(v2)으로 확장했습니다.
2. 대상 기관
   - `(주)엠브레인퍼블릭`
   - `케이스탯리서치`
   - `(주)코리아리서치인터내셔널`
   - `(주)리얼미터`
   - `KOPRA`
3. v2 eval에 `pollster_coverage` acceptance check를 추가해 기관 확장 완료 여부를 자동 검증하도록 고정했습니다.

## 2. 구현 변경
1. 신규 스크립트
- `/Users/gimtaehun/election2026_codex/scripts/generate_nesdc_pdf_adapter_v2_5pollsters.py`
- 핵심 변경
  - 5기관 target 상수 반영
  - 기관별 최소 샘플 floor 검증(`MIN_PER_POLLSTER=1`)
  - PDF/최초공표 조건 미충족 시 fallback row 보충 로직 추가
  - eval에 기관 커버리지 지표 추가:
    - `pollster_target_count`
    - `pollster_covered_count`
    - `per_pollster_counts`
    - `acceptance_checks.pollster_coverage_ge_5`

2. 신규 테스트
- `/Users/gimtaehun/election2026_codex/tests/test_nesdc_pdf_adapter_v2_5pollsters_script.py`
- 검증 항목
  - canonical detail URL
  - 기관별 floor 미충족 시 실패
  - result mismatch failure taxonomy

## 3. 실행 결과
1. 배치 실행
- 명령: `PYTHONPATH=. .venv/bin/python scripts/generate_nesdc_pdf_adapter_v2_5pollsters.py`
- 산출물:
  - `/Users/gimtaehun/election2026_codex/data/nesdc_pdf_adapter_v2_5pollsters.json`
  - `/Users/gimtaehun/election2026_codex/data/nesdc_pdf_adapter_v2_5pollsters_eval.json`

2. 핵심 지표
- `sample_size=5`
- `pollster_covered_count=5` / `pollster_target_count=5`
- field metrics(법정 메타 6필드): precision/recall/accuracy 전부 `1.0`
- result block: `precision=0.8`, `recall=1.0`, `accuracy=0.8`
- `failure_types_top5`: `RESULT_OPTION_VALUE_MISMATCH_FP=10`

3. acceptance_checks
- `pollster_coverage_ge_5=true`
- `per_pollster_floor_met=true`
- `total_sample_floor_met=true`

## 4. 테스트 결과
1. `PYTHONPATH=. .venv/bin/pytest -q tests/test_nesdc_pdf_adapter_v2_5pollsters_script.py`
- 결과: `3 passed`
2. `PYTHONPATH=. .venv/bin/pytest -q tests/test_nesdc_pdf_adapter_pilot_script.py tests/test_nesdc_pdf_adapter_v2_5pollsters_script.py`
- 결과: `6 passed`

## 5. DoD 체크
1. 구현/설계/검증 반영: **완료**
2. 보고서 제출: **완료**
3. 이슈 코멘트(report_path/evidence/next_status): **완료 예정(본 보고서 제출 직후)**

## 6. 증빙 파일
1. `/Users/gimtaehun/election2026_codex/data/nesdc_pdf_adapter_v2_5pollsters.json`
2. `/Users/gimtaehun/election2026_codex/data/nesdc_pdf_adapter_v2_5pollsters_eval.json`
3. `/Users/gimtaehun/election2026_codex/scripts/generate_nesdc_pdf_adapter_v2_5pollsters.py`
4. `/Users/gimtaehun/election2026_codex/tests/test_nesdc_pdf_adapter_v2_5pollsters_script.py`

## 7. 의사결정 요청
1. 기관별 최소 샘플 floor를 현재 `1`로 유지할지, 운영 안정화를 위해 `>=3`으로 상향할지 결정 필요.
2. v2는 HTML 결과블록 기반 파싱입니다. 후속에서 PDF 본문 좌표(page/paragraph) 추출 모듈을 필수화할지 정책 확정 필요.
