# [COLLECTOR][S3] 기사검색 실데이터 수집기 전환(2h 주기) 보고서 (#227)

## 1) 목표
- 기사 검색 기반 실데이터 수집을 샘플 JSON 의존 없이 상시 수집으로 전환
- 법정 필수항목 completeness score 산출 + review_queue 라우팅
- ingest API upsert 성공(30건 이상) 증빙 확보

## 2) 구현 내용
1. 라이브 뉴스 배치 스크립트 추가
- `scripts/generate_collector_live_news_v1_pack.py`
- 파이프라인:
  - `DiscoveryPipelineV11`로 실시간 후보 기사 수집(RSS + 검색)
  - `PollCollector.extract`로 관측치/옵션 추출
  - 법정 필수항목 6개(`pollster/sponsor/survey_period/sample_size/response_rate/margin_of_error`) completeness 계산
  - threshold(`0.8`) 미달건을 `review_queue`로 자동 라우팅
  - ingest payload 생성

2. 2시간 주기 스케줄 워크플로우 추가
- `.github/workflows/collector-live-news-schedule.yml`
- cron: `0 */2 * * *`
- 빌드/생성/ingest/API 헬스/아티팩트 업로드 포함

3. 테스트 추가
- `tests/test_collector_live_news_v1_pack_script.py`

## 3) 산출물
- `data/collector_live_news_v1_candidates.json`
- `data/collector_live_news_v1_output.json`
- `data/collector_live_news_v1_payload.json`
- `data/collector_live_news_v1_report.json`
- `data/collector_live_news_v1_review_queue_candidates.json`
- `data/collector_live_news_v1_payload_30.json` (ingest 실증 payload)
- `data/collector_live_news_v1_ingest_api_response.json`

## 4) 검증
### 4-1. 테스트
```bash
PYTHONPATH=. /Users/gimtaehun/election2026_codex/.venv/bin/pytest -q \
  tests/test_collector_live_news_v1_pack_script.py \
  tests/test_collector_extract.py
```
- 결과: `14 passed`

### 4-2. 실데이터 배치 생성
```bash
PYTHONPATH=. /Users/gimtaehun/election2026_codex/.venv/bin/python \
  scripts/generate_collector_live_news_v1_pack.py
```

리포트 핵심 수치(`data/collector_live_news_v1_report.json`):
- discovery raw/dedup/fetched/valid: `245 / 80 / 80 / 40`
- ingest_record_count: `40`
- threshold_miss_count: `40`
- acceptance: `ingest_records_ge_30=true`

### 4-3. ingest API upsert 실증
실행(로컬 API):
```bash
curl -X POST http://127.0.0.1:8102/api/v1/jobs/run-ingest \
  -H "Authorization: Bearer <INTERNAL_JOB_TOKEN>" \
  --data @data/collector_live_news_v1_payload_30.json
```
응답(`data/collector_live_news_v1_ingest_api_response.json`):
```json
{"run_id":348,"processed_count":30,"error_count":0,"status":"success"}
```

## 5) 완료 기준 충족 여부
- `data/collector_live_news_*` 산출물 + 보고서 제출: 충족
- ingest API 실데이터 30건 이상 upsert 성공: 충족(`processed_count=30`)

## 6) 의사결정 필요사항
1. 현재 completeness 기준(`0.8`)에서 threshold 미달 비율이 높습니다(40/40).
- 수집기 보강(스폰서/표본/응답률/오차범위 파싱 강화) 우선 여부 결정 필요.
2. fallback 기사 비중이 높아(`fallback_fetch_count=69`) source quality gate(도메인 allowlist/본문품질 점수) 추가 여부 결정 필요.
